\documentclass{article}
\usepackage{booktabs}
\usepackage{amsmath}
\begin{document}
\section{B.2}
\begin{table}[h!]
  \begin{center}
    \caption{fully-associative cache}
    \label{tab:table1}
    \begin{tabular}{c|c|c|c} % <-- Alignments: 1st column left, 2nd middle and 3rd right, with vertical lines in between
      \toprule
      \textbf{Cache block} & \textbf{Set} & \textbf{Way} & \textbf{Possible memory blocks}\\
      \hline
      0 & 0 & 0 & M0, M1, ..., M31\\
      \hline
      1 & 0 & 1 & M0, M1, ..., M31\\
      \hline
      2 & 0 & 2 & M0, M1, ..., M31\\
      \hline
      3 & 0 & 3 & M0, M1, ..., M31\\
      \hline
      4 & 0 & 4 & M0, M1, ..., M31\\
      \hline
      5 & 0 & 5 & M0, M1, ..., M31\\
      \hline
      6 & 0 & 6 & M0, M1, ..., M31\\
      \hline
      7 & 0 & 7 & M0, M1, ..., M31\\
      \bottomrule
    \end{tabular}
  \end{center}
\end{table}
\begin{table}[h!]
  \begin{center}
    \caption{four-way set associative cache}
    \label{tab:table2}
    \begin{tabular}{c|c|c|c} % <-- Alignments: 1st column left, 2nd middle and 3rd right, with vertical lines in between
      \toprule
      \textbf{Cache block} & \textbf{Set} & \textbf{Way} & \textbf{Possible memory blocks}\\
      \hline
      0 & 0 & 0 & M0, M2, ..., M28, M30\\
      \hline
      1 & 0 & 1 & M0, M2, ..., M28, M30\\
      \hline
      2 & 0 & 2 & M0, M2, ..., M28, M30\\
      \hline
      3 & 0 & 3 & M0, M2, ..., M28, M30\\
      \hline
      4 & 1 & 0 & M1, M3, ..., M29, M31\\
      \hline
      5 & 1 & 1 & M1, M3, ..., M29, M31\\
      \hline
      6 & 1 & 2 & M1, M3, ..., M29, M31\\
      \hline
      7 & 1 & 3 & M1, M3, ..., M29, M31\\
      \bottomrule
    \end{tabular}
  \end{center}
\end{table}
\section{B.3}

\indent \textbf{a.}\\
\indent For the LRU replacement policy, a read hit will access the data subarray, tag, bsubarray and the replacement subarray of the 4 way simultaneously, thus the power consumption is $4\times(20+5+1)=104$ power units.\\

For the FIFO replacement policy, a read hit will access the data subarray and tag subarray of the 4 way simultaneously, thus the power consumption is $4\times(20+5)=100$ power units.\\

For the random replacement policy, a read hit will access the data subarray and tag subarray of the 4 way simultaneously, thus the power consumption is $4\times(20+5)=100$ power units.\\

\textbf{b.}\\
\indent For the LRU replacement policy, a read miss needs an extra memory access compared to the read hit case, thus the power consumption is $104+200=304$ power units.\\

For the FIFO replacement policy, it needs to access the memory as well, plus one acess to the replacement subarray, so the power consumption is: $100+200+1=301$ power units.\\

For the random replacement policy, it is also a memory access plus one read hit: $100+200=300$ power units.\\

\textbf{c.}\\
\indent For the LRU replacement policy, a read hit will access the tag subarray and the replacement subarray of the 4 way in the first cycle, and then access the matched data subarray in the second cycle. Thus the power consumption is $4\times(5+1)+20=44$ power units.\\

For the FIFO replacement policy, a read hit will access the tag subarray of the 4 way in the first cycle, and then access the matched data subarray in the second cycle. Thus the power consumption is $4\times5+20=40$ power units.\\

For the random replacement policy, a read hit will access the tag subarray of the 4 way in the first cycle, and then access the matched data subarray in the second cycle. Thus the power consumption is $4\times5+20=40$ power units.\\

\textbf{d.}\\
\indent For the LRU replacement policy, it will access the tag subarray and the replacement subarray of the 4 way in the first cycle, and then access the memory. Thus the power consumption is $4\times(5+1)+200=224$ power units.\\

For the FIFO replacement policy, it will access the tag subarray of the 4 way in the first cycle, and then one access to memory and one access to the replacement subarray. Thus the power consumption is $4\times5+200+1=221$ power units.\\

For the random replacement policy, it will access the tag subarray of the 4 way in the first cycle, and then one access to memory. Thus the power consumption is $4\times5+200=220$ power units.\\

\textbf{e.}\\
\indent For the LRU replacement policy, if the way predictor hits, it access the tag subarray, replacement subarray and data subarray for only the predicated way, thus the power consumption is $5+1+20=26$ power units.\\

For the FIFO replacement policy, it's one access to the tag subarray and the data subarray for only the predicated way, thus the power consumption is $5+20=25$ power units.\\

For the random replacement policy, it the same as the FIFO, thus 25 power units.\\

\textbf{f.}\\
Way predictor miss followed by a two-cycle cache read (the cache read split across two cycles) hit is equivalent to a normal read hit plus one extra access to tag subarray.

\indent For the LRU replacement policy, it's $44+5+1=50$ power units.\\

\indent For the FIFO replacement policy, it's $40+5=45$ power units.\\

\indent For the random replacement policy, it's $40+5=45$ power units.\\

\textbf{g.}\\
\indent Way predictor miss followed by a two-cycle cache read (the cache read split across two cycles) miss is equivalent to a normal read miss plus one extra cycle 1.

\indent For the LRU replacement policy, it's $224+5+1=230$ power units.\\

\indent For the FIFO replacement policy, it's $221+5=226$ power units.\\

\indent For the random replacement policy, it's $220+5=225$ power units.\\

\textbf{h.}\\
\begin{align*}
  P(\text{case e}) &= P(\text{cache hit})\times P(\text{way hit})=0.97*0.95=0.9215\\
  P(\text{case f}) &= P(\text{cache hit})\times P(\text{way miss})=0.97*0.05=0.0485\\
  P(\text{case g}) &= P(\text{cache miss})=0.03
\end{align*}
In the above equation, $P(case g) = P(cache miss)$ because a cache miss implies a way miss.\\
\indent For the LRU replacement policy: $26\times 0.9215+50\times 0.0485+230\times 0.03=33.05$ power units.\\

\indent For the FIFO replacement policy, it's $25\times 0.9215+45\times 0.0485+226\times 0.03=31.775$ power units.\\

\indent For the random replacement policy, it's $25\times 0.9215+45\times 0.0485+225\times 0.03=31.745$ power units.\\

\section{B.2}

\indent \textbf{a.}\\
Average memory access time for instrution access = (L1 I-cache miss rate) $\times$ (average access time from L1 I-cache to L2 cache) + (L1 I-cache miss rate) $\times$ (L2 cache miss rate) $\times$ (average access time from L2 cache to the main memory + average L2 cache dirty block write back time)\\
Average access time from L1 I-cache to L2 cache = $15\text{ns}+\frac{32\text{ bytes}}{128\text{ bits}}\times\frac{1\times 10^9}{266 \text{MHz}}\text{ns}=22.519\text{ ns}$\\
Average access time from L2 cache to main memory = $60\text{ns}+\frac{64\text{ bytes}}{128\text{ bits}}\times\frac{1\times 10^9}{133 \text{MHz}}\text{ns}=90.075\text{ ns}$\\
Average L2 cache dirty block write back time = $0.5\times 60\text{ns}+\frac{64\text{ bytes}}{128\text{ bits}}\times\frac{1\times 10^9}{133 \text{MHz}}\text{ns}=45.038\text{ ns}$\\
Thus, the average memory access time for instrution access = $0.02\times 22.519+0.02\times (1-0.8)\times (90.075+45.038)=0.991\text{ns}$.\\

\indent \textbf{b.}\\
Average memory access time for data read = (L1 D-cache miss rate) $\times$ (average access time from L1 D-cache to L2 cache) + (L1 D-cache miss rate) $\times$ (L2 cache miss rate) $\times$ (average access time from L2 cache to the main memory + average L2 cache dirty block write back time)\\
Average access time from L1 D-cache to L2 cache = $15\text{ns}+\frac{16\text{ bytes}}{128\text{ bits}}\times\frac{1\times 10^9}{266 \text{MHz}}\text{ns}=18.759\text{ ns}$\\
Average access time from L2 cache to main memory = 90.075ns\\
Average L2 cache dirty block write back time = 45.038ns\\
Thus, the average memory access time for data read = $0.05\times 18.759+0.05\times (1-0.8)\times (90.075+45.038)=2.289\text{ns}$.\\

\indent \textbf{c.}\\
Since the write policy for the L1 D-cache is write through, and the write policy for the L2 cache is write back, we suppose that a write to L1 D-cache will also write to L2 cache, and a write to L2 cache will only write to main memory if the we miss the block in L2 cache. We also suppose that if we miss a block when we write to cache (both L1 and L2), we will load that block into cache.
Average memory access time for data write = (L1 D-cache miss rate) $\times$ (average access time from L1 D-cache to L2 cache) + (L1 D-cache miss rate) $\times$ (L2 cache miss rate) $\times$ (average access time from L2 cache to the main memory + average L2 cache dirty block write back time)\\
Average access time from L1 D-cache to L2 cache = $15\text{ns}+\frac{16\text{ bytes}}{128\text{ bits}}\times\frac{1\times 10^9}{266 \text{MHz}}\text{ns}=18.759\text{ ns}$\\
Average access time from L2 cache to main memory = 90.075ns\\
Average L2 cache dirty block write back time = 45.038ns\\
Thus, the average memory access time for data read = $0.05\times 18.759+0.05\times (1-0.8)\times (90.075+45.038)=2.289\text{ns}$.\\
\end{document}